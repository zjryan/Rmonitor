<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>服务器性能监控</title>
    <link href="../static/bootstrap.min.css" rel="stylesheet">
    <script src="../static/jquery.js"></script>
    <script src="../static/api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.js"></script>
    <script>
        var labelLength = 30;

        var createCPUChart = function (min1, min5, min10) {
            var labels = new Array(labelLength);
            for(var i = 0; i < 30; i++) {
                labels[i] = i*2;
            }

            var d = {
                labels: labels,
                datasets: [
                    {
                        label: "cpu 1min平均负载",
                        data: min1,
                        backgroundColor: "rgba(151,187,205,0.2)",
                        borderColor: "rgba(151,187,205,1)",
                        pointBorderColor: "rgba(151,187,205,1)",
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 2,
                    },
                    {
                        label: "cpu 5min平均负载",
                        data: min5,
                        backgroundColor: "rgba(151,227,205,0.3)",
                        borderColor: "rgba(151,227,205,1)",
                        pointBorderColor: "rgba(151,227,205,1)",
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 2,
                    },
                    {
                        label: "cpu 10min平均负载",
                        data: min10,
                        backgroundColor: "rgba(220,220,220,0.4)",
                        borderColor: "rgba(220,220,220,1)",
                        pointBorderColor: "rgba(220,220,220,1)",
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 2,
                    }
                ]
            };

            var options = {
                responsive: false,
                animation: false,
                scales: {
                    xAxes: [{
                        display: true,
                    }],
                    yAxes: [{}]
                }
            };

            var cpuLineChart = {
                type: 'line',
                data: d,
                options: options
            };
            var ctx = $('#cpuChart').get(0);
            var cpu = new Chart(ctx, cpuLineChart);
        };

        var updateChart = function () {
            var form = {
                'data_len': labelLength,
            };
            var success = function (r) {
                if (r.success) {
                    log('success');
                    var min1 = r.data.cpu_min1;
                    var min5 = r.data.cpu_min5;
                    var min15 = r.data.cpu_min15;
                    createCPUChart(min1, min5, min15);
                } else {
                    log('failed');
                }
            };
            var error = function (err) {
                log(err);
            };
            chart.serverStatus(form, success, error)
        };

        var __main = function () {
            setInterval(function () {
                updateChart();
            }, 2000);
        };

        $(document).ready(function () {
            __main();
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>服务器信息</h1>
        <canvas id="cpuChart" width="500" height="500"></canvas>
    </div>
</body>
</html>